import{j as e}from"./vendor-ui-3vVLwvSG.js";import{r as o}from"./vendor-react-3RSvEdhP.js";import{B as b,C as n,e as c,I as K,a as v,b as E,d as Z,f as M}from"./index-CgMhWZQG.js";import{T as ee,a as se,b as D,c as j,d as ae,e as h}from"./table-C-QtM0IN.js";import{S as _,a as S,b as C,c as L,d as t}from"./select-BFo01T9H.js";import{D as te,a as le,b as re,c as ne,d as ce}from"./dialog-Xn2gZ5Td.js";import{T as de,a as ie,b as I,c as O}from"./tabs-CxOMK5TM.js";import{u as xe}from"./vendor-i18n-BvwHJnYO.js";import{q as A,f as w}from"./vendor-utils-DC3_vehr.js";import{D as R,H as q,P as U,a2 as H,v as V,U as W,S as oe,Y as he,g as me,s as je,E as k,a5 as ue}from"./vendor-icons-O1RA8j5J.js";import"./vendor-charts-BNo0ya6L.js";const pe=()=>{const i=[],d=["admin@hwk.com","qip.manager@hwk.com","trainer01@hwk.com"],s=["PROGRAM","RESULT","SESSION","EMPLOYEE"],u=["CREATE","UPDATE","DELETE","VIEW","EXPORT"];for(let p=0;p<50;p++){const x=s[Math.floor(Math.random()*s.length)],m=u[Math.floor(Math.random()*u.length)],f=Math.floor(Math.random()*30),T=Math.floor(Math.random()*24);i.push({log_id:`LOG-${String(p+1).padStart(6,"0")}`,entity_type:x,entity_id:`${x.substring(0,3)}-${String(Math.floor(Math.random()*100)).padStart(3,"0")}`,action:m,changed_by:d[Math.floor(Math.random()*d.length)],changed_at:w(A(new Date,f).setHours(T,Math.floor(Math.random()*60)),"yyyy-MM-dd'T'HH:mm:ss"),ip_address:`192.168.1.${Math.floor(Math.random()*255)}`,user_agent:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",before_data:m==="UPDATE"?{field:"old_value"}:void 0,after_data:m!=="DELETE"&&m!=="VIEW"?{field:"new_value"}:void 0,reason:m==="UPDATE"||m==="DELETE"?"관리자 요청에 의한 수정":void 0})}return i.sort((p,x)=>new Date(x.changed_at).getTime()-new Date(p.changed_at).getTime())};function fe({open:i,onClose:d,log:s}){return s?e.jsx(te,{open:i,onOpenChange:d,children:e.jsxs(le,{className:"max-w-2xl",children:[e.jsxs(re,{children:[e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"감사 로그 상세"]}),e.jsxs(ce,{children:["로그 ID: ",s.log_id]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(n,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(E,{className:"text-sm",children:"기본 정보"})}),e.jsx(c,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"작업 유형"}),e.jsx(M,{variant:s.action==="CREATE"?"success":s.action==="UPDATE"?"warning":s.action==="DELETE"?"destructive":"secondary",className:"mt-1",children:s.action})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"대상 유형"}),e.jsx("p",{className:"font-medium",children:s.entity_type})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"대상 ID"}),e.jsx("p",{className:"font-mono",children:s.entity_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"작업자"}),e.jsx("p",{className:"font-medium",children:s.changed_by})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"작업 일시"}),e.jsx("p",{children:w(new Date(s.changed_at),"yyyy-MM-dd HH:mm:ss")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"IP 주소"}),e.jsx("p",{className:"font-mono",children:s.ip_address||"-"})]})]})})]}),s.reason&&e.jsxs(n,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(E,{className:"text-sm",children:"변경 사유"})}),e.jsx(c,{children:e.jsx("p",{className:"text-sm",children:s.reason})})]}),(s.before_data||s.after_data)&&e.jsxs(n,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(E,{className:"text-sm",children:"변경 내역"})}),e.jsx(c,{children:e.jsxs(de,{defaultValue:"after",children:[e.jsxs(ie,{className:"grid w-full grid-cols-2",children:[e.jsx(I,{value:"before",disabled:!s.before_data,children:"변경 전"}),e.jsx(I,{value:"after",disabled:!s.after_data,children:"변경 후"})]}),e.jsx(O,{value:"before",className:"mt-2",children:e.jsx("pre",{className:"text-xs bg-muted p-3 rounded overflow-auto max-h-48",children:JSON.stringify(s.before_data,null,2)})}),e.jsx(O,{value:"after",className:"mt-2",children:e.jsx("pre",{className:"text-xs bg-muted p-3 rounded overflow-auto max-h-48",children:JSON.stringify(s.after_data,null,2)})})]})})]}),s.user_agent&&e.jsxs(n,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(E,{className:"text-sm",children:"클라이언트 정보"})}),e.jsx(c,{children:e.jsx("p",{className:"text-xs text-muted-foreground break-all",children:s.user_agent})})]})]})]})}):null}function Ce(){xe();const[i]=o.useState(pe),[d,s]=o.useState(""),[u,p]=o.useState("all"),[x,m]=o.useState("all"),[f,T]=o.useState("7"),[B,G]=o.useState(null),[X,P]=o.useState(!1),N=o.useMemo(()=>{const a=parseInt(f),y=A(new Date,a);return i.filter(l=>{const r=l.log_id.toLowerCase().includes(d.toLowerCase())||l.entity_id.toLowerCase().includes(d.toLowerCase())||l.changed_by.toLowerCase().includes(d.toLowerCase()),J=u==="all"||l.entity_type===u,Q=x==="all"||l.action===x,F=new Date(l.changed_at)>=y;return r&&J&&Q&&F})},[i,d,u,x,f]),g=o.useMemo(()=>{const a=parseInt(f),y=A(new Date,a),l=i.filter(r=>new Date(r.changed_at)>=y);return{total:l.length,creates:l.filter(r=>r.action==="CREATE").length,updates:l.filter(r=>r.action==="UPDATE").length,deletes:l.filter(r=>r.action==="DELETE").length,uniqueUsers:new Set(l.map(r=>r.changed_by)).size}},[i,f]),$=a=>{G(a),P(!0)},z=a=>{switch(a){case"CREATE":return e.jsx(U,{className:"h-4 w-4 text-green-500"});case"UPDATE":return e.jsx(H,{className:"h-4 w-4 text-blue-500"});case"DELETE":return e.jsx(V,{className:"h-4 w-4 text-red-500"});case"VIEW":return e.jsx(k,{className:"h-4 w-4 text-gray-500"});case"EXPORT":return e.jsx(R,{className:"h-4 w-4 text-purple-500"});default:return e.jsx(ue,{className:"h-4 w-4 text-gray-500"})}},Y=a=>({CREATE:"success",UPDATE:"warning",DELETE:"destructive",VIEW:"secondary",EXPORT:"default",LOGIN:"default",LOGOUT:"secondary"})[a]||"secondary";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"감사 로그"}),e.jsx("p",{className:"text-muted-foreground",children:"시스템 활동 및 변경 이력 조회"})]}),e.jsxs(b,{variant:"outline",children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),"로그 내보내기"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-5",children:[e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(q,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:g.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"전체 활동"})]})]})})}),e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(U,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:g.creates}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"생성"})]})]})})}),e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(H,{className:"h-5 w-5 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:g.updates}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"수정"})]})]})})}),e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(V,{className:"h-5 w-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:g.deletes}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"삭제"})]})]})})}),e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(W,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:g.uniqueUsers}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"활동 사용자"})]})]})})})]}),e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(oe,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(K,{placeholder:"로그 ID, 대상 ID, 사용자로 검색...",className:"pl-8",value:d,onChange:a=>s(a.target.value)})]}),e.jsxs(_,{value:u,onValueChange:p,children:[e.jsx(S,{className:"w-full md:w-40",children:e.jsx(C,{placeholder:"대상 유형"})}),e.jsxs(L,{children:[e.jsx(t,{value:"all",children:"전체 유형"}),e.jsx(t,{value:"PROGRAM",children:"프로그램"}),e.jsx(t,{value:"RESULT",children:"교육 결과"}),e.jsx(t,{value:"SESSION",children:"교육 세션"}),e.jsx(t,{value:"EMPLOYEE",children:"직원"})]})]}),e.jsxs(_,{value:x,onValueChange:m,children:[e.jsx(S,{className:"w-full md:w-40",children:e.jsx(C,{placeholder:"작업 유형"})}),e.jsxs(L,{children:[e.jsx(t,{value:"all",children:"전체 작업"}),e.jsx(t,{value:"CREATE",children:"생성"}),e.jsx(t,{value:"UPDATE",children:"수정"}),e.jsx(t,{value:"DELETE",children:"삭제"}),e.jsx(t,{value:"VIEW",children:"조회"}),e.jsx(t,{value:"EXPORT",children:"내보내기"})]})]}),e.jsxs(_,{value:f,onValueChange:T,children:[e.jsx(S,{className:"w-full md:w-40",children:e.jsx(C,{placeholder:"기간"})}),e.jsxs(L,{children:[e.jsx(t,{value:"1",children:"최근 1일"}),e.jsx(t,{value:"7",children:"최근 7일"}),e.jsx(t,{value:"30",children:"최근 30일"}),e.jsx(t,{value:"90",children:"최근 90일"})]})]})]})})}),e.jsxs(n,{children:[e.jsxs(v,{children:[e.jsx(E,{children:"활동 로그"}),e.jsxs(Z,{children:["조회된 로그 ",N.length,"건"]})]}),e.jsxs(c,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:e.jsxs(D,{children:[e.jsx(j,{children:"로그 ID"}),e.jsx(j,{children:"작업"}),e.jsx(j,{children:"대상"}),e.jsx(j,{children:"대상 ID"}),e.jsx(j,{children:"작업자"}),e.jsx(j,{children:"일시"}),e.jsx(j,{children:"IP"}),e.jsx(j,{className:"text-right",children:"상세"})]})}),e.jsx(ae,{children:N.length===0?e.jsx(D,{children:e.jsxs(h,{colSpan:8,className:"text-center py-8 text-muted-foreground",children:[e.jsx(he,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),"조회된 로그가 없습니다"]})}):N.slice(0,50).map(a=>e.jsxs(D,{children:[e.jsx(h,{className:"font-mono text-xs",children:a.log_id}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[z(a.action),e.jsx(M,{variant:Y(a.action),children:a.action})]})}),e.jsx(h,{children:e.jsx(M,{variant:"outline",children:a.entity_type})}),e.jsx(h,{className:"font-mono text-xs",children:a.entity_id}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-6 w-6 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(W,{className:"h-3 w-3 text-primary"})}),e.jsx("span",{className:"text-sm truncate max-w-[120px]",children:a.changed_by})]})}),e.jsx(h,{children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(me,{className:"h-3 w-3 text-muted-foreground"}),w(new Date(a.changed_at),"yyyy-MM-dd")]}),e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(je,{className:"h-3 w-3"}),w(new Date(a.changed_at),"HH:mm:ss")]})]})}),e.jsx(h,{className:"font-mono text-xs",children:a.ip_address||"-"}),e.jsx(h,{className:"text-right",children:e.jsxs(b,{variant:"ghost",size:"sm",onClick:()=>$(a),children:[e.jsx(k,{className:"h-4 w-4 mr-1"}),"상세"]})})]},a.log_id))})]}),N.length>50&&e.jsxs("div",{className:"mt-4 text-center",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[N.length-50,"개의 추가 로그가 있습니다"]}),e.jsx(b,{variant:"outline",className:"mt-2",children:"더 보기"})]})]})]}),e.jsx(fe,{open:X,onClose:()=>P(!1),log:B})]})}export{Ce as default};
