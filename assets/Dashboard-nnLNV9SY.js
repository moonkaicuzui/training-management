import{j as e}from"./vendor-ui-3vVLwvSG.js";import{u as G,r as w}from"./vendor-react-3RSvEdhP.js";import{B as n,C as d,a as c,b as m,e as x,d as p,f as h}from"./index-DbE0N-7e.js";import{T as S,a as K,b as C,c as i,d as H,e as t}from"./table-C47-Z7GG.js";import{L as O,a as U}from"./LazyCharts-DetV40kx.js";import{u as q}from"./normalizedStore-BGqUWCoD.js";import{P as I}from"./LoadingSpinner-C546iy_4.js";import{u as V}from"./vendor-i18n-BmxLmPQ7.js";import{T as D,j as J,q as _,v as k,P as T,i as b,w as Q,g as W}from"./vendor-icons-B-g4Br4W.js";import{B as A}from"./vendor-charts-B2i3rig-.js";import{f as E}from"./vendor-utils-CC1vNFCq.js";const X={AA:"#059669",A:"#10B981",B:"#F59E0B",C:"#EF4444"};function oe(){const{t:s}=V(),r=G(),{derived:o,loading:B,fetchDashboardStats:R,fetchMonthlyData:z,fetchGradeDistribution:M,fetchRetrainingTargets:$,fetchExpiringTrainings:L}=q(),u=o.dashboard.stats,y=o.dashboard.monthlyData,g=o.dashboard.gradeDistribution,j=o.retraining.targets,f=o.retraining.expiring,[N,v]=w.useState(null);if(w.useEffect(()=>{(async()=>{try{v(null),await Promise.all([R(),z(),M(),$(),L(30)])}catch(l){console.error("Dashboard data fetch error:",l),v(s("messages.loadError"))}})()},[]),B.views.dashboard)return e.jsx(I,{});if(N)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-[400px] space-y-4",children:[e.jsx(D,{className:"h-12 w-12 text-destructive"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:N}),e.jsx(n,{onClick:()=>window.location.reload(),children:s("common.retry")})]});const F=[{title:s("dashboard.totalEmployees"),value:u?.totalEmployees??0,icon:J,color:"text-primary",bgColor:"bg-primary/10",link:"/employees",trend:null},{title:s("dashboard.monthlyCompletions"),value:u?.monthlyCompletions??0,icon:_,color:"text-status-pass",bgColor:"bg-status-pass/10",link:"/results",trend:null},{title:s("dashboard.completionRate"),value:`${u?.overallCompletionRate??0}%`,icon:k,color:"text-primary",bgColor:"bg-primary/10",link:"/results",trend:null},{title:s("dashboard.retrainingNeeded"),value:u?.retrainingCount??0,icon:D,color:"text-destructive",bgColor:"bg-destructive/10",link:"/retraining",trend:null}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:s("dashboard.title")}),e.jsx("p",{className:"text-muted-foreground",children:s("dashboard.welcome")})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{onClick:()=>r("/schedule"),children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),s("dashboard.newTraining")]}),e.jsxs(n,{variant:"outline",onClick:()=>r("/results"),children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),s("dashboard.enterResults")]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:F.map((a,l)=>e.jsxs(d,{className:"cursor-pointer transition-all hover:shadow-lg hover:-translate-y-1 group",onClick:()=>r(a.link),role:"button",tabIndex:0,onKeyDown:P=>P.key==="Enter"&&r(a.link),children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:a.title}),e.jsx("div",{className:`p-2 rounded-full ${a.bgColor} group-hover:scale-110 transition-transform`,children:e.jsx(a.icon,{className:`h-4 w-4 ${a.color}`})})]}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a.value}),a.trend!==null&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsxs("span",{className:a.trend>0?"text-status-pass":"text-destructive",children:[a.trend>0?"↑":"↓"," ",Math.abs(a.trend),"%"]})," ",s("dashboard.fromLastMonth")]})]})]},l))}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(d,{children:[e.jsxs(c,{children:[e.jsx(m,{children:s("dashboard.monthlyChart")}),e.jsx(p,{children:s("dashboard.plannedVsCompleted")})]}),e.jsx(x,{children:y.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[300px] text-center px-4",children:[e.jsx("div",{className:"rounded-full bg-muted p-6 mb-4",children:e.jsx(_,{className:"h-12 w-12 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("dashboard.noMonthlyData")}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-sm mb-4",children:s("dashboard.noMonthlyDataDesc")}),e.jsxs(n,{onClick:()=>r("/schedule"),variant:"outline",size:"sm",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),s("dashboard.scheduleTraining")]})]}):e.jsxs(O,{data:y,height:300,xAxisKey:"month",xAxisFormatter:a=>a.substring(5),children:[e.jsx(A,{dataKey:"planned",name:s("dashboard.planned"),fill:"#93C5FD",radius:[4,4,0,0]}),e.jsx(A,{dataKey:"completed",name:s("dashboard.completed"),fill:"#1E40AF",radius:[4,4,0,0]})]})})]}),e.jsxs(d,{children:[e.jsxs(c,{children:[e.jsx(m,{children:s("dashboard.gradeDistribution")}),e.jsx(p,{children:s("dashboard.gradeDesc")})]}),e.jsx(x,{children:g.length===0||g.every(a=>a.count===0)?e.jsxs("div",{className:"flex flex-col items-center justify-center h-[300px] text-center px-4",children:[e.jsx("div",{className:"rounded-full bg-muted p-6 mb-4",children:e.jsx(k,{className:"h-12 w-12 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("dashboard.noGradeData")}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-sm mb-4",children:s("dashboard.noGradeDataDesc")}),e.jsxs(n,{onClick:()=>r("/results"),variant:"outline",size:"sm",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),s("dashboard.enterResults")]})]}):e.jsx(U,{data:g,height:300,colors:X})})]})]}),e.jsxs(d,{children:[e.jsxs(c,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(m,{children:s("retraining.title")}),e.jsxs(p,{children:[s("dashboard.retrainingList")," ",s("dashboard.recent10")]})]}),j.length>0&&e.jsx(n,{variant:"outline",size:"sm",onClick:()=>r("/retraining"),children:s("common.viewAll")})]}),e.jsx(x,{children:j.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center px-4",children:[e.jsx("div",{className:"rounded-full bg-status-pass/10 p-6 mb-4",children:e.jsx(b,{className:"h-12 w-12 text-status-pass"})}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("dashboard.noRetrainingNeeded")}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-sm",children:s("dashboard.allEmployeesCompliant")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs(S,{children:[e.jsx(K,{children:e.jsxs(C,{children:[e.jsx(i,{children:s("employee.name")}),e.jsx(i,{children:s("employee.position")}),e.jsx(i,{children:s("employee.building")}),e.jsx(i,{children:s("common.program")}),e.jsx(i,{children:s("common.failDate")}),e.jsx(i,{children:s("common.score")}),e.jsx(i,{children:s("common.actions")})]})}),e.jsx(H,{children:j.slice(0,10).map((a,l)=>e.jsxs(C,{children:[e.jsx(t,{className:"font-medium",children:a.employee.employee_name}),e.jsx(t,{children:a.employee.position}),e.jsx(t,{children:s(`building.${a.employee.building}`)}),e.jsxs(t,{children:[e.jsx(h,{variant:"outline",children:a.program.program_code}),e.jsx("span",{className:"ml-2 text-sm",children:a.program.program_name})]}),e.jsx(t,{children:E(new Date(a.last_result.training_date),"yyyy-MM-dd")}),e.jsx(t,{children:e.jsx(h,{variant:"destructive",children:a.last_result.score??"N/A"})}),e.jsx(t,{children:e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>r(`/employees/${a.employee.employee_id}`),children:s("common.detail")})})]},l))})]})}),e.jsx("div",{className:"md:hidden space-y-3",children:j.slice(0,10).map((a,l)=>e.jsxs(d,{className:"p-4 shadow-sm hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-base",children:a.employee.employee_name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.employee.position})]}),e.jsx(h,{variant:"destructive",children:a.last_result.score??"N/A"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-muted-foreground",children:[s("employee.building"),":"]}),e.jsx("span",{className:"font-medium",children:s(`building.${a.employee.building}`)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-muted-foreground",children:[s("common.program"),":"]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx(h,{variant:"outline",className:"mb-1",children:a.program.program_code}),e.jsx("span",{className:"text-xs",children:a.program.program_name})]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-muted-foreground",children:[s("common.failDate"),":"]}),e.jsx("span",{className:"font-medium",children:E(new Date(a.last_result.training_date),"yyyy-MM-dd")})]})]}),e.jsx(n,{variant:"outline",size:"sm",className:"w-full mt-3",onClick:()=>r(`/employees/${a.employee.employee_id}`),children:s("common.detail")})]},l))})]})})]}),f.length>0&&e.jsxs(d,{className:"border-warning/50 bg-warning/5",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-full bg-warning/20",children:e.jsx(Q,{className:"h-5 w-5 text-warning"})}),e.jsxs("div",{children:[e.jsx(m,{className:"text-lg",children:s("progress.expiring")}),e.jsxs(p,{children:[s("dashboard.recent10")," - ",f.length,"건"]})]})]}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>r("/retraining"),children:s("common.viewAll")})]}),e.jsx(x,{children:e.jsx("div",{className:"grid gap-3 md:grid-cols-2 lg:grid-cols-3",children:f.slice(0,6).map((a,l)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-background hover:shadow-sm transition-shadow cursor-pointer",onClick:()=>r(`/employees/${a.employee.employee_id}`),children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:a.employee.employee_name}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:a.program.program_name})]}),e.jsx("div",{className:"flex items-center gap-2 ml-2",children:e.jsxs(h,{variant:a.days_until_expiry<=7?"destructive":"outline",className:a.days_until_expiry<=7?"":"border-warning text-warning",children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),"D-",a.days_until_expiry]})})]},l))})})]})]})}export{oe as default};
