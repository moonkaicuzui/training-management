import{j as e}from"./vendor-ui-3vVLwvSG.js";import{r as N,l as A,u as L}from"./vendor-react-3RSvEdhP.js";import{C as u,a as g,b as p,B as o,d as S,e as f,H as M}from"./index-DbE0N-7e.js";import{T as F,a as Q,b as y,c as w}from"./tabs-BiL_WdmF.js";import{P as q}from"./LoadingSpinner-C546iy_4.js";import{C as b,T as G}from"./TraineeStatusBadge-27eUosfM.js";import{a as R}from"./TrainingStageTimeline-Db2yO2Pa.js";import{D as U,a as H,b as V,c as z,d as W,e as $}from"./dialog-D5PoXStQ.js";import{L as k}from"./label-Dcyga6z7.js";import{T as J}from"./textarea-DKXFBtN7.js";import{S as K,a as X,b as Y,c as Z,d as P}from"./select-B9RdTlAY.js";import{E as ee,P as se,g as E,U as ae,aw as te,O as le,a6 as re,m as ie,q as ne}from"./vendor-icons-B-g4Br4W.js";import{f as O}from"./vendor-utils-CC1vNFCq.js";import{a as B}from"./MeetingScheduleCard-CfxCra1l.js";import"./LazyCharts-DetV40kx.js";import{g as de,e as ce,c as oe,d as me,T as xe}from"./newTqcStore-CYv8xO33.js";import"./switch-DEYTfbKs.js";import"./table-C47-Z7GG.js";import"./vendor-i18n-BmxLmPQ7.js";import"./vendor-charts-B2i3rig-.js";function he({traineeId:l,traineeName:m,currentStatus:x,tests:v,onAddTest:T}){const[h,n]=N.useState(!1),[d,j]=N.useState({result:"PASS",notes:""}),[C,c]=N.useState(!1),s=async()=>{c(!0);try{await T({trainee_id:l,test_date:new Date().toISOString().split("T")[0],result:d.result,notes:d.notes||void 0}),n(!1),j({result:"PASS",notes:""})}finally{c(!1)}},i=[...v].sort((t,r)=>new Date(r.test_date).getTime()-new Date(t.test_date).getTime());return e.jsxs(e.Fragment,{children:[e.jsxs(u,{children:[e.jsxs(g,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-muted-foreground"}),e.jsx(p,{className:"text-lg",children:"Color Blind 검사"})]}),e.jsxs(o,{size:"sm",onClick:()=>n(!0),children:[e.jsx(se,{className:"h-4 w-4 mr-1"}),"검사 등록"]})]}),e.jsxs(S,{children:[m,"의 색맹 검사 이력입니다."]})]}),e.jsxs(f,{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4 p-3 bg-muted/50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"현재 상태:"}),e.jsx(b,{result:x})]}),i.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"검사 이력"}),e.jsx("div",{className:"space-y-2",children:i.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(b,{result:t.result}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(E,{className:"h-3.5 w-3.5"}),O(new Date(t.test_date),"yyyy-MM-dd")]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(ae,{className:"h-3.5 w-3.5"}),t.tested_by]})]}),t.notes&&e.jsx("span",{className:"text-sm text-muted-foreground truncate max-w-[200px]",children:t.notes})]},t.test_id))})]}):e.jsxs("div",{className:"text-center py-6 text-muted-foreground",children:[e.jsx(te,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"검사 이력이 없습니다."})]})]})]}),e.jsx(U,{open:h,onOpenChange:n,children:e.jsxs(H,{children:[e.jsxs(V,{children:[e.jsx(z,{children:"Color Blind 검사 등록"}),e.jsxs(W,{children:[m,"의 색맹 검사 결과를 등록합니다."]})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"검사 결과"}),e.jsxs(K,{value:d.result,onValueChange:t=>j(r=>({...r,result:t})),children:[e.jsx(X,{children:e.jsx(Y,{})}),e.jsxs(Z,{children:[e.jsx(P,{value:"PASS",children:"정상 (PASS)"}),e.jsx(P,{value:"FAIL",children:"색맹 (FAIL)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"비고 (선택)"}),e.jsx(J,{placeholder:"특이사항을 입력하세요",value:d.notes,onChange:t=>j(r=>({...r,notes:t.target.value}))})]})]}),e.jsxs($,{children:[e.jsx(o,{variant:"outline",onClick:()=>n(!1),children:"취소"}),e.jsx(o,{onClick:s,disabled:C,children:C?"저장 중...":"등록"})]})]})})]})}function Ie(){const{id:l}=A(),m=L(),x=de(),v=ce(),T=oe(),{fetchTraineeDetail:h,fetchTeams:n,createColorBlindTest:d,updateMeeting:j}=me(),[C,c]=N.useState(!1);if(N.useEffect(()=>{l&&(h(l),n())},[l]),T.traineeDetail||!x)return e.jsx(q,{});const s=x,{stages:i,colorBlindTests:t,meetings:r}=x,_=v.find(a=>a.team_id===s.team_id),I=async a=>{await d(a),l&&await h(l)},D=async a=>{await j({meeting_id:a,status:"COMPLETED",completed_date:new Date().toISOString().split("T")[0]}),l&&await h(l)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>m("/new-tqc/trainees"),children:e.jsx(le,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:s.name}),e.jsx(G,{status:s.status})]}),e.jsxs("p",{className:"text-muted-foreground",children:[_?.team_name||s.team_id," • ",s.trainer_id," 트레이너 • ",s.start_week,"주차"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",onClick:()=>c(!0),children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"수정"]}),s.status==="IN_TRAINING"&&e.jsxs(o,{variant:"destructive",onClick:()=>m(`/new-tqc/trainees/${l}/resign`),children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"퇴사 처리"]})]})]}),e.jsxs(F,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(Q,{children:[e.jsx(y,{value:"overview",children:"개요"}),e.jsx(y,{value:"training",children:"교육 진행"}),e.jsx(y,{value:"meetings",children:"미팅"}),e.jsx(y,{value:"colorblind",children:"Color Blind 검사"})]}),e.jsxs(w,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(p,{className:"text-lg",children:"기본 정보"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"이름"}),e.jsx("p",{className:"font-medium",children:s.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"사번"}),e.jsx("p",{className:"font-medium",children:s.employee_id||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"배치예정팀"}),e.jsx("p",{className:"font-medium",children:_?.team_name||s.team_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"담당 트레이너"}),e.jsx("p",{className:"font-medium",children:s.trainer_id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"시작일"}),e.jsxs("p",{className:"font-medium",children:[O(new Date(s.start_date),"yyyy-MM-dd")," (",s.start_week,"주차)"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"소개자"}),e.jsx("p",{className:"font-medium",children:s.introducer||"-"})]})]}),e.jsx(M,{}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Color Blind 상태"}),e.jsx(b,{result:s.color_blind_status})]})]})]}),e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(p,{className:"text-lg",children:"교육 진행률"}),e.jsx(S,{children:"전체 교육 과정 진행 현황"})]}),e.jsx(f,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"relative w-32 h-32",children:[e.jsxs("svg",{className:"w-full h-full transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"currentColor",strokeWidth:"12",fill:"none",className:"text-muted"}),e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"currentColor",strokeWidth:"12",fill:"none",strokeDasharray:`${s.progress_percentage/100*352} 352`,className:"text-primary"})]}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("span",{className:"text-2xl font-bold",children:[s.progress_percentage,"%"]})})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"p-2 bg-status-pass/10 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-status-pass",children:i.filter(a=>a.status==="COMPLETED").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"완료"})]}),e.jsxs("div",{className:"p-2 bg-primary/10 rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:i.filter(a=>a.status==="IN_PROGRESS").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"진행중"})]}),e.jsxs("div",{className:"p-2 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-2xl font-bold text-muted-foreground",children:i.filter(a=>a.status==="PENDING").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"대기"})]})]})]})})]})]}),e.jsxs(u,{children:[e.jsx(g,{children:e.jsxs(p,{className:"text-lg flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"미팅 일정"]})}),e.jsx(f,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:r.map(a=>e.jsx(B,{meeting:a,onComplete:D},a.meeting_id))})})]})]}),e.jsx(w,{value:"training",children:e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsxs(p,{className:"text-lg flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"교육 단계"]}),e.jsx(S,{children:"교육 진행 단계별 현황입니다. 클릭하여 상태를 변경할 수 있습니다."})]}),e.jsx(f,{children:e.jsx(R,{stages:i,onStageClick:a=>{console.log("Stage clicked:",a)}})})]})}),e.jsx(w,{value:"meetings",children:e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:r.map(a=>e.jsx(B,{meeting:a,onComplete:D},a.meeting_id))})}),e.jsx(w,{value:"colorblind",children:e.jsx(he,{traineeId:s.trainee_id,traineeName:s.name,currentStatus:s.color_blind_status,tests:t,onAddTest:I})})]}),e.jsx(xe,{open:C,onClose:()=>c(!1),onSubmit:async a=>{console.log("Update trainee:",a),c(!1)},trainee:s,teams:v})]})}export{Ie as default};
