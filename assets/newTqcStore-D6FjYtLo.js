import{j as s}from"./vendor-ui-3vVLwvSG.js";import{r as T}from"./vendor-react-3RSvEdhP.js";import{I as f,B as N,q as Q,r as b,M as R,N as A,O as H,P as I,Q as L,R as U,T as B,U as O,V as k,W as G,X as Y,Y as W,Z as V,_ as P,$ as q,a0 as K,a1 as X,a2 as Z}from"./index-DaEJbrWA.js";import{L as h}from"./label-BskPfqn2.js";import{D as $,a as z,b as J,c as ee,d as ae,e as ie}from"./dialog-DC5LqXCn.js";import{S as x,a as y,b as F,c as C,d as j}from"./select-RMpD2WFK.js";const ne=["KIM ANH","NGUYÊN","TRÚC","HẰNG","THÀNH","CƯỜNG","LINH","THÙY LINH","HUYỀN"],ge=["Orientation","Basic Training","Line Assignment","Field Evaluation"];function se(a){const r=new Date(a),i=new Date(r.getFullYear(),0,1),e=r.getTime()-i.getTime(),n=1e3*60*60*24*7;return Math.ceil(e/n+1)}const E={name:"",team_id:"",trainer_id:"",start_date:new Date().toISOString().split("T")[0],employee_id:void 0,introducer:void 0};function me({open:a,onClose:r,onSubmit:i,trainee:e,teams:n}){const t=!!e,[l,m]=T.useState(E),[d,v]=T.useState(!1),[c,p]=T.useState({});T.useEffect(()=>{m(e?{name:e.name,team_id:e.team_id,trainer_id:e.trainer_id,start_date:e.start_date,employee_id:e.employee_id,introducer:e.introducer}:E),p({})},[e,a]);const S=()=>{const o={};return l.name.trim()||(o.name="이름을 입력하세요."),l.team_id||(o.team_id="배치예정팀을 선택하세요."),l.trainer_id||(o.trainer_id="트레이너를 선택하세요."),l.start_date||(o.start_date="시작일을 선택하세요."),p(o),Object.keys(o).length===0},D=async()=>{if(S()){v(!0);try{await i(l),r()}finally{v(!1)}}},u=(o,M)=>{m(_=>({..._,[o]:M})),c[o]&&p(_=>({..._,[o]:""}))},w=l.start_date?se(l.start_date):null;return s.jsx($,{open:a,onOpenChange:r,children:s.jsxs(z,{className:"sm:max-w-[500px]",children:[s.jsxs(J,{children:[s.jsx(ee,{children:t?"교육생 수정":"신규 교육생 등록"}),s.jsx(ae,{children:t?"교육생 정보를 수정합니다.":"새로운 신입 교육생을 등록합니다."})]}),s.jsxs("div",{className:"grid gap-4 py-4",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsxs(h,{htmlFor:"name",children:["이름 ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsx(f,{id:"name",value:l.name,onChange:o=>u("name",o.target.value),placeholder:"교육생 이름",className:c.name?"border-destructive":""}),c.name&&s.jsx("p",{className:"text-xs text-destructive",children:c.name})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(h,{htmlFor:"employee_id",children:"사번 (선택)"}),s.jsx(f,{id:"employee_id",value:l.employee_id||"",onChange:o=>u("employee_id",o.target.value||void 0),placeholder:"사번이 있는 경우 입력"})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(h,{children:["배치예정팀 ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsxs(x,{value:l.team_id,onValueChange:o=>u("team_id",o),children:[s.jsx(y,{className:c.team_id?"border-destructive":"",children:s.jsx(F,{placeholder:"팀 선택"})}),s.jsx(C,{children:n.filter(o=>o.is_active).map(o=>s.jsx(j,{value:o.team_id,children:o.team_name},o.team_id))})]}),c.team_id&&s.jsx("p",{className:"text-xs text-destructive",children:c.team_id})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(h,{children:["담당 트레이너 ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsxs(x,{value:l.trainer_id,onValueChange:o=>u("trainer_id",o),children:[s.jsx(y,{className:c.trainer_id?"border-destructive":"",children:s.jsx(F,{placeholder:"트레이너 선택"})}),s.jsx(C,{children:ne.map(o=>s.jsx(j,{value:o,children:o},o))})]}),c.trainer_id&&s.jsx("p",{className:"text-xs text-destructive",children:c.trainer_id})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsxs(h,{htmlFor:"start_date",children:["교육 시작일 ",s.jsx("span",{className:"text-destructive",children:"*"})]}),s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsx(f,{id:"start_date",type:"date",value:l.start_date,onChange:o=>u("start_date",o.target.value),className:c.start_date?"border-destructive":""}),w&&s.jsxs("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:["(",w,"주차)"]})]}),c.start_date&&s.jsx("p",{className:"text-xs text-destructive",children:c.start_date})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx(h,{htmlFor:"introducer",children:"소개자 (선택)"}),s.jsx(f,{id:"introducer",value:l.introducer||"",onChange:o=>u("introducer",o.target.value||void 0),placeholder:"소개자 이름"})]})]}),s.jsxs(ie,{children:[s.jsx(N,{variant:"outline",onClick:r,disabled:d,children:"취소"}),s.jsx(N,{onClick:D,disabled:d,children:d?"저장 중...":t?"수정":"등록"})]})]})})}const g=Q()(b((a,r)=>({teams:[],trainees:[],selectedTrainee:null,traineeFilters:{},meetings:[],upcomingMeetings:[],meetingFilters:{},resignations:[],resignationFilters:{},resignationAnalysis:null,dashboardStats:null,loading:{teams:!1,trainees:!1,traineeDetail:!1,meetings:!1,resignations:!1,dashboard:!1,analysis:!1,saving:!1},error:null,fetchTeams:async(i=!1)=>{a(e=>({loading:{...e.loading,teams:!0},error:null}));try{const e=await Z(i);a({teams:e,loading:{...r().loading,teams:!1}})}catch(e){const n=e instanceof Error?e.message:"Failed to fetch teams";a({error:n,loading:{...r().loading,teams:!1}})}},createTeam:async i=>{a(e=>({loading:{...e.loading,saving:!0},error:null}));try{const e=await X(i);return a(n=>({teams:[...n.teams,e],loading:{...n.loading,saving:!1}})),e}catch(e){const n=e instanceof Error?e.message:"Failed to create team";throw a({error:n,loading:{...r().loading,saving:!1}}),e}},updateTeam:async i=>{a(e=>({loading:{...e.loading,saving:!0},error:null}));try{const e=await K(i);e&&a(n=>({teams:n.teams.map(t=>t.team_id===i.team_id?e:t),loading:{...n.loading,saving:!1}}))}catch(e){const n=e instanceof Error?e.message:"Failed to update team";throw a({error:n,loading:{...r().loading,saving:!1}}),e}},deleteTeam:async i=>{a(e=>({loading:{...e.loading,saving:!0},error:null}));try{await q(i),a(e=>({teams:e.teams.filter(n=>n.team_id!==i),loading:{...e.loading,saving:!1}}))}catch(e){const n=e instanceof Error?e.message:"Failed to delete team";throw a({error:n,loading:{...r().loading,saving:!1}}),e}},fetchTrainees:async i=>{a(e=>({loading:{...e.loading,trainees:!0},error:null,traineeFilters:i||e.traineeFilters}));try{const e=await P(i||r().traineeFilters);a({trainees:e,loading:{...r().loading,trainees:!1}})}catch(e){const n=e instanceof Error?e.message:"Failed to fetch trainees";a({error:n,loading:{...r().loading,trainees:!1}})}},fetchTraineeDetail:async i=>{a(e=>({loading:{...e.loading,traineeDetail:!0},error:null}));try{const e=await V(i);a({selectedTrainee:e,loading:{...r().loading,traineeDetail:!1}})}catch(e){const n=e instanceof Error?e.message:"Failed to fetch trainee detail";a({error:n,loading:{...r().loading,traineeDetail:!1}})}},setTraineeFilters:i=>{a({traineeFilters:i})},createTrainee:async i=>{a(e=>({loading:{...e.loading,saving:!0},error:null}));try{const e=await W(i);return a(n=>({trainees:[e,...n.trainees],loading:{...n.loading,saving:!1}})),e}catch(e){const n=e instanceof Error?e.message:"Failed to create trainee";throw a({error:n,loading:{...r().loading,saving:!1}}),e}},updateTrainee:async i=>{a(e=>({loading:{...e.loading,saving:!0},error:null}));try{const e=await Y(i);e&&a(n=>({trainees:n.trainees.map(t=>t.trainee_id===i.trainee_id?e:t),selectedTrainee:n.selectedTrainee?.trainee_id===i.trainee_id?{...n.selectedTrainee,...e}:n.selectedTrainee,loading:{...n.loading,saving:!1}}))}catch(e){const n=e instanceof Error?e.message:"Failed to update trainee";throw a({error:n,loading:{...r().loading,saving:!1}}),e}},clearSelectedTrainee:()=>{a({selectedTrainee:null})},createColorBlindTest:async i=>{a(e=>({loading:{...e.loading,saving:!0},error:null}));try{const e=await G(i);return r().selectedTrainee?.trainee_id===i.trainee_id&&a(t=>({selectedTrainee:t.selectedTrainee?{...t.selectedTrainee,color_blind_status:i.result,colorBlindTests:[e,...t.selectedTrainee.colorBlindTests]}:null,loading:{...t.loading,saving:!1}})),a(t=>({trainees:t.trainees.map(l=>l.trainee_id===i.trainee_id?{...l,color_blind_status:i.result}:l),loading:{...t.loading,saving:!1}})),e}catch(e){const n=e instanceof Error?e.message:"Failed to create color blind test";throw a({error:n,loading:{...r().loading,saving:!1}}),e}},updateTrainingStage:async i=>{a(e=>({loading:{...e.loading,saving:!0},error:null}));try{const e=await k(i);if(e){const n=r();if(n.selectedTrainee){const t=n.selectedTrainee.stages.map(d=>d.stage_id===i.stage_id?e:d),l=t.filter(d=>d.status==="COMPLETED").length,m=Math.round(l/t.length*100);a(d=>({selectedTrainee:d.selectedTrainee?{...d.selectedTrainee,stages:t,progress_percentage:m,status:m===100?"COMPLETED":d.selectedTrainee.status}:null,loading:{...d.loading,saving:!1}}))}}}catch(e){const n=e instanceof Error?e.message:"Failed to update training stage";throw a({error:n,loading:{...r().loading,saving:!1}}),e}},fetchMeetings:async i=>{a(e=>({loading:{...e.loading,meetings:!0},error:null,meetingFilters:i||e.meetingFilters}));try{const e=await O(i||r().meetingFilters);a({meetings:e,loading:{...r().loading,meetings:!1}})}catch(e){const n=e instanceof Error?e.message:"Failed to fetch meetings";a({error:n,loading:{...r().loading,meetings:!1}})}},fetchUpcomingMeetings:async(i=7)=>{a(e=>({loading:{...e.loading,meetings:!0},error:null}));try{const e=await B(i);a({upcomingMeetings:e,loading:{...r().loading,meetings:!1}})}catch(e){const n=e instanceof Error?e.message:"Failed to fetch upcoming meetings";a({error:n,loading:{...r().loading,meetings:!1}})}},setMeetingFilters:i=>{a({meetingFilters:i})},createMeeting:async i=>{a(e=>({loading:{...e.loading,saving:!0},error:null}));try{const e=await U(i);return a(n=>({meetings:[...n.meetings,e],loading:{...n.loading,saving:!1}})),e}catch(e){const n=e instanceof Error?e.message:"Failed to create meeting";throw a({error:n,loading:{...r().loading,saving:!1}}),e}},updateMeeting:async i=>{a(e=>({loading:{...e.loading,saving:!0},error:null}));try{const e=await L(i);e&&a(n=>({meetings:n.meetings.map(t=>t.meeting_id===i.meeting_id?e:t),upcomingMeetings:n.upcomingMeetings.filter(t=>t.meeting_id!==i.meeting_id||e.status==="SCHEDULED"),selectedTrainee:n.selectedTrainee&&n.selectedTrainee.meetings.some(t=>t.meeting_id===i.meeting_id)?{...n.selectedTrainee,meetings:n.selectedTrainee.meetings.map(t=>t.meeting_id===i.meeting_id?e:t)}:n.selectedTrainee,loading:{...n.loading,saving:!1}}))}catch(e){const n=e instanceof Error?e.message:"Failed to update meeting";throw a({error:n,loading:{...r().loading,saving:!1}}),e}},fetchResignations:async i=>{a(e=>({loading:{...e.loading,resignations:!0},error:null,resignationFilters:i||e.resignationFilters}));try{const e=await I(i||r().resignationFilters);a({resignations:e,loading:{...r().loading,resignations:!1}})}catch(e){const n=e instanceof Error?e.message:"Failed to fetch resignations";a({error:n,loading:{...r().loading,resignations:!1}})}},fetchResignationAnalysis:async()=>{a(i=>({loading:{...i.loading,analysis:!0},error:null}));try{const i=await H();a({resignationAnalysis:i,loading:{...r().loading,analysis:!1}})}catch(i){const e=i instanceof Error?i.message:"Failed to fetch resignation analysis";a({error:e,loading:{...r().loading,analysis:!1}})}},setResignationFilters:i=>{a({resignationFilters:i})},createResignation:async i=>{a(e=>({loading:{...e.loading,saving:!0},error:null}));try{const e=await A(i);return a(n=>({trainees:n.trainees.map(t=>t.trainee_id===i.trainee_id?{...t,status:"RESIGNED"}:t),resignations:[e,...n.resignations],loading:{...n.loading,saving:!1}})),e}catch(e){const n=e instanceof Error?e.message:"Failed to create resignation";throw a({error:n,loading:{...r().loading,saving:!1}}),e}},fetchDashboardStats:async()=>{a(i=>({loading:{...i.loading,dashboard:!0},error:null}));try{const i=await R();a({dashboardStats:i,loading:{...r().loading,dashboard:!1}})}catch(i){const e=i instanceof Error?i.message:"Failed to fetch dashboard stats";a({error:e,loading:{...r().loading,dashboard:!1}})}},clearError:()=>{a({error:null})}}),{name:"new-tqc-store"})),ue=()=>g(a=>a.teams),he=()=>g(a=>a.trainees),Te=()=>g(a=>a.selectedTrainee),fe=()=>g(a=>a.meetings),pe=()=>g(a=>a.upcomingMeetings),_e=()=>g(a=>a.resignations),ve=()=>g(a=>a.resignationAnalysis),we=()=>g(a=>a.dashboardStats),Ne=()=>g(a=>a.loading),xe=()=>g(a=>a.traineeFilters),ye=()=>g(a=>a.meetingFilters),Fe=()=>g(a=>a.resignationFilters),Ce=()=>g(a=>({fetchTeams:a.fetchTeams,createTeam:a.createTeam,updateTeam:a.updateTeam,deleteTeam:a.deleteTeam,fetchTrainees:a.fetchTrainees,fetchTraineeDetail:a.fetchTraineeDetail,setTraineeFilters:a.setTraineeFilters,createTrainee:a.createTrainee,updateTrainee:a.updateTrainee,clearSelectedTrainee:a.clearSelectedTrainee,createColorBlindTest:a.createColorBlindTest,updateTrainingStage:a.updateTrainingStage,fetchMeetings:a.fetchMeetings,fetchUpcomingMeetings:a.fetchUpcomingMeetings,setMeetingFilters:a.setMeetingFilters,createMeeting:a.createMeeting,updateMeeting:a.updateMeeting,fetchResignations:a.fetchResignations,fetchResignationAnalysis:a.fetchResignationAnalysis,setResignationFilters:a.setResignationFilters,createResignation:a.createResignation,fetchDashboardStats:a.fetchDashboardStats,clearError:a.clearError}));export{ge as D,ne as N,me as T,he as a,pe as b,Ne as c,Ce as d,ue as e,xe as f,Te as g,fe as h,ye as i,_e as j,ve as k,Fe as l,we as u};
